#include <stdio.h>
#include <stdlib.h>
#include <math.h>

double shannon_entropy(const char* filename) {
  FILE* file = fopen(filename, "rb");

  if (!file) {
    fprintf(stderr, "Error: Could not open file '%s'\n", filename);
    return -1.0;
  }

  int frequencies[256] = {0}; // Initialize frequencies for all byte values (0-255)

  // Read data from the file and count byte frequencies
  int byte;
  while ((byte = fgetc(file)) != EOF) {
    frequencies[byte]++;
  }

  fclose(file);

  double entropy = 0.0;
  int total_bytes = 0;

  // Calculate total number of bytes
  for (int i = 0; i < 256; i++) {
    total_bytes += frequencies[i];
  }

  for (int i = 0; i < 256; i++) {
    int count = frequencies[i];
    if (count > 0) {
      double probability = (double)count / total_bytes;
      entropy -= probability * log2(probability);
    }
  }

  return entropy;
}

int main(int argc, char* argv[]) {
  if (argc != 2) {
    fprintf(stderr, "Usage: %s <filename>\n", argv[0]);
    return 1;
  }

  const char* filename = argv[1];
  double entropy = shannon_entropy(filename);

  if (entropy >= 0) {
    printf("Entropy of %s: %.4f\n", filename, entropy);
  }

  return 0;
}
