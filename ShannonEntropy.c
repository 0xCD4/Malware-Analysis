#include <stdio.h>
#include <stdlib.h>
#include <math.h>

#define RED   "\x1B[31m"
#define RESET "\x1B[0m"


double shannon_entropy(const char* filename){
    FILE* file = fopen(filename, "rb");

if(!file){
    fprintf(stderr, "Error: Could not open the file '%s'\n", filename);

    return -1;
}

int freq[256] = {0};

int byte;

while((byte = fgetc(file)) != EOF){
    freq[byte]++;
}

fclose(file);

double entropy = 0.0;
int total_byte = 0;

for(int i =0 ; i<256; i++){
    total_byte += freq[i];
}

for(int j = 0; j<256; j++){
    int count = freq[j];
    if(count > 0){
        double prob = (double)count / total_byte;
        entropy -= prob * log2(prob);
    }
}

return entropy;

}



int main(int argc, char* argv[]){

    if(argc != 2){
        fprintf(stderr, "Usage: %s <file-name>\n", argv[0]);

        return 1;
    }

    // filename = demo.exe
    const char* filename = argv[1];
    double entropy = shannon_entropy(filename);

    if(entropy >= 0){
        printf(RED "Entropy of %s: %.5f\n" RESET, filename, entropy);
    } 

    return 0;
}
